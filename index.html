savePngBtn.onclick = () => {
        if(isGenerating) return;
        const sx = scaleXInput.value;
        const sy = scaleYInput.value;
        const width = BASE_SIZE * sx;
        const height = BASE_SIZE * sy;
        const img = new Image();
        const svgBlob = new Blob([currentSVGString], {type: 'image/svg+xml;charset=utf-8'});
        const url = URL.createObjectURL(svgBlob);
        
        img.onload = () => {
            const canvas = document.createElement('canvas');
            canvas.width = width; canvas.height = height;
            const ctx = canvas.getContext('2d');
            
            // 배경색 채우기
            const currentBg = isColorMode && currentColorPalette ? currentColorPalette.bg : monoTheme.bg;
            ctx.fillStyle = currentBg;
            ctx.fillRect(0,0,width,height);
            ctx.drawImage(img, 0, 0);
            URL.revokeObjectURL(url);
            
            const modeStr = isColorMode ? 'Color' : 'Mono';
            const fileName = `Nullwood_DotTree_${currentStyle.name.split(' ')[0]}_${modeStr}_${sx}x${sy}.png`;

            canvas.toBlob((blob) => {
                // [핵심 수정] 모바일 공유 기능 지원 시 공유 창 띄우기
                const file = new File([blob], fileName, { type: 'image/png' });
                
                // navigator.canShare가 지원되고, 파일 공유가 가능한 경우 (주로 모바일)
                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                    navigator.share({
                        files: [file],
                        title: 'Nullwood Pattern',
                        text: 'Generated by Nullwood Black Tree Generator'
                    })
                    .catch((error) => console.log('Sharing failed', error));
                } else {
                    // PC이거나 공유 기능 미지원 시 기존 방식(파일 다운로드)
                    downloadBlob(blob, fileName);
                }
            }, 'image/png');
        };
        img.src = url;
    };
